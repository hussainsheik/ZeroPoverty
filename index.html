<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futuristic Mandal Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Exo+2:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            font-family: 'Exo 2', sans-serif;
            background: linear-gradient(135deg, #0A0A0A 0%, #121212 100%);
            color: #fff;
            overflow-x: hidden;
        }
        .hero {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            background: url('https://source.unsplash.com/random/1920x1080/?cyberpunk');
            background-size: cover;
            overflow: hidden;
        }
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }
        .hero h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            text-shadow: 0 0 10px #00F5FF, 0 0 20px #FF00F5;
            z-index: 1;
        }
        .navbar {
            position: sticky;
            top: 0;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            padding: 1rem;
            z-index: 1000;
            text-align: center;
        }
        .navbar select {
            background: #1a1a1a;
            color: #00FFA3;
            border: 1px solid #00F5FF;
            padding: 0.5rem;
            font-family: 'Exo 2', sans-serif;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .navbar select:hover {
            box-shadow: 0 0 10px #00F5FF;
        }
        .content {
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid #00F5FF;
            border-radius: 10px;
            padding: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px #FF00F5;
        }
        #map {
            height: 400px;
            border-radius: 10px;
            border: 1px solid #00FFA3;
        }
        #pieChart, #barChart, #stackedBarChart {
            max-width: 400px;
            margin: 0 auto;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .stat-box {
            background: rgba(0, 245, 255, 0.1);
            padding: 1rem;
            border-radius: 5px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .stat-box:hover {
            background: rgba(0, 245, 255, 0.2);
            box-shadow: 0 0 10px #00F5FF;
        }
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            .hero h1 {
                font-size: 2rem;
            }
            #pieChart, #barChart, #stackedBarChart {
                max-width: 100%;
            }
        }
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
    </style>
</head>
<body>
    <div class="hero">
        <canvas class="particles" id="particles"></canvas>
        <h1>Mandal Insights Dashboard</h1>
    </div>
    <div class="navbar">
        <select id="mandalFilter">
            <option value="">All Mandals</option>
        </select>
    </div>
    <div class="content">
        <div class="card">
            <h2>Pie Chart: Families vs Adopted</h2>
            <canvas id="pieChart"></canvas>
        </div>
        <div class="card">
            <h2>Geographical Distribution</h2>
            <div id="map"></div>
        </div>
        <div class="card">
            <h2>Mandal Comparison</h2>
            <canvas id="barChart"></canvas>
        </div>
        <div class="card">
            <h2>Secretariats Overview</h2>
            <canvas id="stackedBarChart"></canvas>
        </div>
        <div class="card stats">
            <div class="stat-box">
                <h3>Total Families</h3>
                <p id="totalFamilies">0</p>
            </div>
            <div class="stat-box">
                <h3>Total Family Members</h3>
                <p id="totalFamilyMembers">0</p>
            </div>
            <div class="stat-box">
                <h3>Total Adopted</h3>
                <p id="totalAdopted">0</p>
            </div>
            <div class="stat-box">
                <h3>Bangaru Kutumbams Yet to Adopt</h3>
                <p id="totalBangaruKutumbams">0</p>
            </div>
            <div class="stat-box">
                <h3>Margadarsi Mobilized</h3>
                <p id="totalMargadarsi">0</p>
            </div>
            <div class="stat-box">
                <h3>Total Secretariats</h3>
                <p id="totalSecretariats">0</p>
            </div>
            <div class="stat-box">
                <h3>Covered Secretariats</h3>
                <p id="coveredSecretariats">0</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
        // Particle Background
        particlesJS('particles', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: '#00F5FF' },
                shape: { type: 'circle' },
                opacity: { value: 0.5, random: true },
                size: { value: 3, random: true },
                line_linked: { enable: true, distance: 150, color: '#FF00F5', opacity: 0.4, width: 1 },
                move: { enable: true, speed: 2, direction: 'none', random: false }
            },
            interactivity: {
                detect_on: 'canvas',
                events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' } },
                modes: { repulse: { distance: 100 }, push: { particles_nb: 4 } }
            }
        });

        // GSAP Animations
        gsap.from('.hero h1', { opacity: 0, y: 50, duration: 1.5, ease: 'power3.out' });
        gsap.from('.navbar', { y: -50, duration: 1, delay: 0.5 });
        gsap.from('.card', { opacity: 0, y: 100, stagger: 0.2, duration: 1, ease: 'power3.out', scrollTrigger: { trigger: '.content' } });

        // Fetch Google Sheet Data
        const sheetId = '1Z9a7qJPdegiqm-NGQztyOru2LPG2zmK-AAMH_L6RjSs'; // Replace with your Google Sheet ID
        const sheetName = 'SubLevelData';
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

        let data = [];
        let mandals = new Set();

        async function fetchData() {
            try {
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                const rows = json.table.rows;

                data = rows.map(row => ({
                    MandalName: row.c[1]?.v || '',
                    TotalFamilies: row.c[2]?.v || 0,
                    TotalFamilyMembers: row.c[3]?.v || 0,
                    TotalAdopted: row.c[4]?.v || 0,
                    TotalMargadarsiMobilized: row.c[6]?.v || 0,
                    TotalSecretariats: row.c[7]?.v || 0,
                    CoveredSecretariats: row.c[8]?.v || 0,
                    TotalBangaruKutumbamsYetToAdopt: (row.c[2]?.v || 0) - (row.c[4]?.v || 0)
                }));

                // Populate mandal filter
                data.forEach(row => mandals.add(row.MandalName));
                const mandalFilter = document.getElementById('mandalFilter');
                mandals.forEach(m => {
                    const option = document.createElement('option');
                    option.value = m;
                    option.textContent = m;
                    mandalFilter.appendChild(option);
                });

                updateDashboard(data);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Initialize Map
        const map = L.map('map').setView([16.5, 81.5], 10); // Centered on West Godavari
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Simulated coordinates for mandals
        const mandalCoordinates = {
            'Achanta (R)': [16.598, 81.824],
            'Penugonda (R)': [16.654, 81.745],
            'Penumantra (R)': [16.632, 81.678],
            'Poduru (R)': [16.578, 81.758],
            'Bhimavaram (R)': [16.540, 81.523],
            'Bhimavaram (U)': [16.543, 81.530],
            'Veeravasaram (R)': [16.533, 81.628],
            'Mogalturu (R)': [16.418, 81.602],
            'Narasapur (U)': [16.436, 81.701],
            'Narasapuram (R)': [16.432, 81.696],
            'Elamanchili (R)': [16.480, 81.782],
            'Palakol (R)': [16.517, 81.725],
            'Palakol (U)': [16.520, 81.730],
            'Pentapadu (R)': [16.787, 81.525],
            'Tadepalligudem (R)': [16.813, 81.521],
            'Tadepalligudem (U)': [16.815, 81.528],
            'Attili (R)': [16.700, 81.600],
            'Iragavaram (R)': [16.677, 81.698],
            'Tanuku (R)': [16.753, 81.677],
            'Tanuku (U)': [16.757, 81.684],
            'Akiveedu (R)': [16.582, 81.382],
            'Akiveedu (U)': [16.585, 81.387],
            'Kalla (R)': [16.518, 81.413],
            'Palakoderu (R)': [16.573, 81.563],
            'Undi (R)': [16.607, 81.463],
            'Ganapavaram (R)': [16.702, 81.462]
        };

        let markers = [];
        function updateMap(filteredData) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            filteredData.forEach(row => {
                const coords = mandalCoordinates[row.MandalName];
                if (coords) {
                    const marker = L.circleMarker(coords, {
                        radius: 8,
                        fillColor: '#00F5FF',
                        color: '#FF00F5',
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map).bindPopup(
                        `<b>${row.MandalName}</b><br>
                        Total Families: ${row.TotalFamilies}<br>
                        Total Adopted: ${row.TotalAdopted}<br>
                        Yet to Adopt: ${row.TotalBangaruKutumbamsYetToAdopt}`
                    );
                    markers.push(marker);
                }
            });
        }

        // Pie Chart
        const pieChart = new Chart(document.getElementById('pieChart'), {
            type: 'pie',
            data: {
                labels: ['Total Families', 'Total Adopted'],
                datasets: [{
                    data: [0, 0],
                    backgroundColor: ['#00F5FF', '#FF00F5'],
                    borderColor: '#121212',
                    borderWidth: 2
                }]
            },
            options: {
                plugins: {
                    legend: { labels: { color: '#fff', font: { family: 'Exo 2' } } }
                }
            }
        });

        // Bar Chart
        const barChart = new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Total Families',
                        data: [],
                        backgroundColor: '#00F5FF',
                        borderColor: '#121212',
                        borderWidth: 1
                    },
                    {
                        label: 'Total Family Members',
                        data: [],
                        backgroundColor: '#FF00F5',
                        borderColor: '#121212',
                        borderWidth: 1
                    },
                    {
                        label: 'Total Adopted',
                        data: [],
                        backgroundColor: '#00FFA3',
                        borderColor: '#121212',
                        borderWidth: 1
                    },
                    {
                        label: 'Margadarsi Mobilized',
                        data: [],
                        backgroundColor: '#FF6F61',
                        borderColor: '#121212',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                plugins: {
                    legend: { labels: { color: '#fff', font: { family: 'Exo 2' } } },
                    title: { display: true, text: 'Mandal Metrics Comparison', color: '#fff', font: { family: 'Orbitron', size: 16 } }
                },
                scales: {
                    y: { beginAtZero: true, ticks: { color: '#fff', font: { family: 'Exo 2' } }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: '#fff', font: { family: 'Exo 2' } }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });

        // Stacked Bar Chart
        const stackedBarChart = new Chart(document.getElementById('stackedBarChart'), {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Covered Secretariats',
                        data: [],
                        backgroundColor: '#00F5FF',
                        borderColor: '#121212',
                        borderWidth: 1
                    },
                    {
                        label: 'Uncovered Secretariats',
                        data: [],
                        backgroundColor: '#FF00F5',
                        borderColor: '#121212',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                plugins: {
                    legend: { labels: { color: '#fff', font: { family: 'Exo 2' } } },
                    title: { display: true, text: 'Secretariats Coverage', color: '#fff', font: { family: 'Orbitron', size: 16 } }
                },
                scales: {
                    x: { stacked: true, ticks: { color: '#fff', font: { family: 'Exo 2' } }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    y: { stacked: true, beginAtZero: true, ticks: { color: '#fff', font: { family: 'Exo 2' } }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });

        function updateDashboard(filteredData) {
            const totals = filteredData.reduce((acc, row) => {
                acc.families += row.TotalFamilies;
                acc.members += row.TotalFamilyMembers;
                acc.adopted += row.TotalAdopted;
                acc.bangaru += row.TotalBangaruKutumbamsYetToAdopt;
                acc.margadarsi += row.TotalMargadarsiMobilized;
                acc.secretariats += row.TotalSecretariats;
                acc.covered += row.CoveredSecretariats;
                return acc;
            }, { families: 0, members: 0, adopted: 0, bangaru: 0, margadarsi: 0, secretariats: 0, covered: 0 });

            document.getElementById('totalFamilies').textContent = totals.families;
            document.getElementById('totalFamilyMembers').textContent = totals.members;
            document.getElementById('totalAdopted').textContent = totals.adopted;
            document.getElementById('totalBangaruKutumbams').textContent = totals.bangaru;
            document.getElementById('totalMargadarsi').textContent = totals.margadarsi;
            document.getElementById('totalSecretariats').textContent = totals.secretariats;
            document.getElementById('coveredSecretariats').textContent = totals.covered;

            // Update Pie Chart
            pieChart.data.datasets[0].data = [totals.families, totals.adopted];
            pieChart.update();

            // Update Bar Chart
            barChart.data.labels = filteredData.map(row => row.MandalName);
            barChart.data.datasets[0].data = filteredData.map(row => row.TotalFamilies);
            barChart.data.datasets[1].data = filteredData.map(row => row.TotalFamilyMembers);
            barChart.data.datasets[2].data = filteredData.map(row => row.TotalAdopted);
            barChart.data.datasets[3].data = filteredData.map(row => row.TotalMargadarsiMobilized);
            barChart.update();

            // Update Stacked Bar Chart
            stackedBarChart.data.labels = filteredData.map(row => row.MandalName);
            stackedBarChart.data.datasets[0].data = filteredData.map(row => row.CoveredSecretariats);
            stackedBarChart.data.datasets[1].data = filteredData.map(row => row.TotalSecretariats - row.CoveredSecretariats);
            stackedBarChart.update();

            updateMap(filteredData);
        }

        // Filter Logic
        document.getElementById('mandalFilter').addEventListener('change', updateFilters);

        function updateFilters() {
            const mandal = document.getElementById('mandalFilter').value;
            let filteredData = data;

            if (mandal) {
                filteredData = filteredData.filter(row => row.MandalName === mandal);
            }

            updateDashboard(filteredData);
        }

        // Initialize
        fetchData();
    </script>
</body>
</html>
